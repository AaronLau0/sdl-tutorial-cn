<!DOCTYPE html>
<html>
 <head> 
  <meta charset="utf-8" /> 
  <title>第11课 - 播放声音 &middot; SDL中文教程</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
  <meta name="description" content="" /> 
  <meta name="author" content="" /> 
  <!-- Le styles --> 
  <link href="../../assets/css/bootstrap.css" rel="stylesheet" /> 
  <link href="../../assets/css/bootstrap-responsive.css" rel="stylesheet" /> 
  <link href="../../assets/css/docs.css" rel="stylesheet" /> 
  <link href="../../assets/js/google-code-prettify/prettify.css" rel="stylesheet" /> 
  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements --> 
  <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--> 
  <!-- Le fav and touch icons --> 
  <link rel="shortcut icon" href="../../assets/ico/favicon.ico" /> 
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../assets/ico/apple-touch-icon-144-precomposed.png" /> 
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../assets/ico/apple-touch-icon-114-precomposed.png" /> 
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../assets/ico/apple-touch-icon-72-precomposed.png" /> 
  <link rel="apple-touch-icon-precomposed" href="../../assets/ico/apple-touch-icon-57-precomposed.png" /> 
 </head> 
 <body data-spy="scroll" data-target=".subnav" data-offset="50">
   ﻿ 
  <!-- Navbar
    ================================================== --> 
  <div class="navbar navbar-fixed-top"> 
   <div class="navbar-inner"> 
    <div class="container"> 
     <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
     <a class="brand" href="../../index.html">SDL中文教程</a> 
     <div class="nav-collapse collapse"> 
      <ul class="nav"> 
       <li class=""><a href="../../index.html">简介</a></li> 
       <li class=""><a href="../../contents.html">目录</a></li> 
       <li class=""><a href="../../about.html">关于</a></li> 
      </ul> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="container"> 
   <div class="row"> 
    <div class="span10 offset1"> 
     <h1 align="center" id="content_title">第11课 - 播放声音</h1> 
     <br /> 
     <p align="center"> <span class="label label-info">更新时间：2012年6月21日</span> </p> 
     <ul class="quick-links"> 
      <li><a class="btn btn-info" target="_blank" id="origin_link" href="http://lazyfoo.net/SDL_tutorials/lesson11/index.php">原文链接</a></li> 
      <li><a class="btn" href="../lesson10/index.html" id="prev_link">上一课</a></li> 
      <li><a class="btn" href="../lesson12/index.html" id="next_link">下一课</a></li> 
     </ul> 
     <hr /> 
    </div> 
   </div> 
   <!-- Main contents start from here --> 
   <div class="row"> 
    <div class="well span10 offset1"> 
     <div class="alert alert-warning"> 
      <strong>译者注：</strong>本页面还未完成翻译，如有兴趣参与本项目，请 
      <strong><a href="../../about.html">联系我</a></strong>！ 
     </div> 
     <div class="content">
      <div class="tutPreface"> 
       <h1 class="tutHead">Playing Sounds</h1> 
       <div class="tutImg"> 
        <img src="preview.jpg" /> 
       </div> 
       <h6>Last Updated 12/31/10</h6> Playing sound is another key concept of game programming. SDL's native sound functions can be quite confusing. So you're going to learn to play sound effects and music using the extension library SDL_mixer. SDL_mixer is an extension library that makes using sound braindead easy. 
       <br /> 
       <br /> You can get SDL_mixer from 
       <a class="tutLink" href="../../../www.libsdl.org/projects/SDL_mixer/default.htm">here</a>. 
       <br /> 
       <br /> To install SDL_mixer just follow the 
       <a class="tutLink" href="../lesson03/index.php">extension library tutorial</a>. Installing SDL_mixer is done pretty much the way SDL_image is, so just replace where you see SDL_image with SDL_mixer. 
       <br /> 
       <br /> This tutorial covers the basics playing music and sound effects using SDL_mixer to play sound effects and &quot;music&quot; I made by tapping on my monitor. 
      </div> 
      <pre class="tutCode prettyprint linenums:1 lang-cpp">//The music that will be played
Mix_Music *music = NULL;

//The sound effects that will be used
Mix_Chunk *scratch = NULL;
Mix_Chunk *high = NULL;
Mix_Chunk *med = NULL;
Mix_Chunk *low = NULL;
</pre> 
      <div class="tutText">
        Here's the new data types we are going to be working with. 
       <br /> 
       <br /> Mix_Music is the data type we use for music, and Mix_Chunk is the data type used for sound effects. 
       <br /> 
      </div> 
      <pre class="tutCode prettyprint linenums:9 lang-cpp">bool init()
{
    //Initialize all SDL subsystems
    if( SDL_Init( SDL_INIT_EVERYTHING ) == -1 )
    {
        return false;    
    }
    
    //Set up the screen
    screen = SDL_SetVideoMode( SCREEN_WIDTH, SCREEN_HEIGHT, SCREEN_BPP, SDL_SWSURFACE );
    
    //If there was an error in setting up the screen
    if( screen == NULL )
    {
        return false;    
    }
    
    //Initialize SDL_ttf
    if( TTF_Init() == -1 )
    {
        return false;    
    }
    
    //Initialize SDL_mixer
    if( Mix_OpenAudio( 22050, MIX_DEFAULT_FORMAT, 2, 4096 ) == -1 )
    {
        return false;    
    }
    
    //Set the window caption
    SDL_WM_SetCaption( &quot;Monitor Music&quot;, NULL );
    
    //If everything initialized fine
    return true;
}
</pre> 
      <div class="tutText">
        In the initialization function, we call Mix_OpenAudio() to initialize SDL_mixer's audio functions. 
       <br /> 
       <br /> Mix_OpenAudio()'s first argument is the sound frequency we use, and in this case it's 22050 which is what's recommended. The second argument is the sound format used which we set to the default. The third argument is how many channels we plan to use. We set it to 2 so we have stereo sound, if it was set to one we'd have mono sound. The last argument is the sample size, which is set to 4096. 
       <br /> 
       <br /> For those of you using OGG, MOD, or other sound formats other than WAV, look into using Mix_Init() to initialize decoders and Mix_Quit() to close the decoders. We're only using WAV files here so let's not add more code for something we're not going to use. 
      </div> 
      <pre class="tutCode prettyprint linenums:44 lang-cpp">bool load_files()
{
    //Load the background image
    background = load_image( &quot;background.png&quot; );
    
    //Open the font
    font = TTF_OpenFont( &quot;lazy.ttf&quot;, 30 );
    
    //If there was a problem in loading the background
    if( background == NULL )
    {
        return false;    
    }
    
    //If there was an error in loading the font
    if( font == NULL )
    {
        return false;
    }
    
    //Load the music
    music = Mix_LoadMUS( &quot;beat.wav&quot; );
    
    //If there was a problem loading the music
    if( music == NULL )
    {
        return false;    
    }

    //Load the sound effects
    scratch = Mix_LoadWAV( &quot;scratch.wav&quot; );
    high = Mix_LoadWAV( &quot;high.wav&quot; );
    med = Mix_LoadWAV( &quot;medium.wav&quot; );
    low = Mix_LoadWAV( &quot;low.wav&quot; );
    
    //If there was a problem loading the sound effects
    if( ( scratch == NULL ) || ( high == NULL ) || ( med == NULL ) || ( low == NULL ) )
    {
        return false;    
    }
    
    //If everything loaded fine
    return true;    
}
</pre> 
      <div class="tutText">
        Here we have the file loading function. 
       <br /> 
       <br /> To load the music, we use Mix_LoadMUS(). Mix_LoadMUS() takes in the filename of the music file and returns the music data. It return NULL if there's an error. 
       <br /> 
       <br /> To load sound effects, we use Mix_LoadWAV(). It loads the sound file of the given file name, and returns a Mix_Chunk or NULL if there was an error. 
      </div> 
      <pre class="tutCode prettyprint linenums:88 lang-cpp">void clean_up()
{
    //Free the surfaces
    SDL_FreeSurface( background );
    
    //Free the sound effects
    Mix_FreeChunk( scratch );
    Mix_FreeChunk( high );
    Mix_FreeChunk( med );
    Mix_FreeChunk( low );
    
    //Free the music
    Mix_FreeMusic( music );
    
    //Close the font
    TTF_CloseFont( font );
    
    //Quit SDL_mixer
    Mix_CloseAudio();
    
    //Quit SDL_ttf
    TTF_Quit();
    
    //Quit SDL
    SDL_Quit();
}
</pre> 
      <div class="tutText">
        In the clean up function, we call Mix_FreeChunk() to get rid of the sound effects and Mix_FreeMusic() to free the music. 
       <br /> 
       <br /> Then after we're done using SDL_mixer, Mix_CloseAudio() is called. 
      </div> 
      <pre class="tutCode prettyprint linenums:114 lang-cpp">    //While the user hasn't quit
    while( quit == false )
    {
        //While there's events to handle
        while( SDL_PollEvent( &amp;event ) )
        {
            //If a key was pressed
            if( event.type == SDL_KEYDOWN )
            {
</pre> 
      <div class="tutText">
        In our main function after the initialization, file loading and background and messages have been blitted, we enter our main loop. Then we start handling events, starting with key presses. 
      </div> 
      <pre class="tutCode prettyprint linenums:123 lang-cpp">                //If 1 was pressed
                if( event.key.keysym.sym == SDLK_1 )
                {
                    //Play the scratch effect
                    if( Mix_PlayChannel( -1, scratch, 0 ) == -1 )
                    {
                        return 1;    
                    }
                }
                //If 2 was pressed
                else if( event.key.keysym.sym == SDLK_2 )
                {
                    //Play the high hit effect
                    if( Mix_PlayChannel( -1, high, 0 ) == -1 )
                    {
                        return 1;    
                    }
                }
                //If 3 was pressed
                else if( event.key.keysym.sym == SDLK_3 )
                {
                    //Play the medium hit effect
                    if( Mix_PlayChannel( -1, med, 0 ) == -1 )
                    {
                        return 1;    
                    }
                }
                //If 4 was pressed
                else if( event.key.keysym.sym == SDLK_4 )
                {
                    //Play the low hit effect
                    if( Mix_PlayChannel( -1, low, 0 ) == -1 )
                    {
                        return 1;    
                    }
                }
</pre> 
      <div class="tutText">
        When checking the key presses, first we check if 1, 2, 3, or 4 have been pressed. These are the keys that play the sound effects. 
       <br /> 
       <br /> If one of the these keys have been pressed, we call Mix_PlayChannel() to play the key's associated sound effect. 
       <br /> 
       <br /> Mix_PlayChannel()'s first argument is which mixing channel we're going to play the sound in. Since it's set to -1, Mix_PlayChannel() just looks for the first channel that's available and plays the sound. 
       <br /> 
       <br /> The second argument in the Mix_Chunk that's going to be played. The third is how many times the sound effect is going to loop. Since it's set to 0, it will only play once. 
       <br /> 
       <br /> When there's a problem playing the sound, Mix_PlayChannel() will return -1. 
      </div> 
      <pre class="tutCode prettyprint linenums:159 lang-cpp">                //If 9 was pressed
                else if( event.key.keysym.sym == SDLK_9 )
                {
                    //If there is no music playing
                    if( Mix_PlayingMusic() == 0 )
                    {
                        //Play the music
                        if( Mix_PlayMusic( music, -1 ) == -1 )
                        {
                            return 1;
                        }    
                    }
</pre> 
      <div class="tutText">
        Next we handle when 9 is pressed, which is supposed to play/pause the music. 
       <br /> 
       <br /> First we check if the music is playing with Mix_PlayingMusic(). If no music is playing we call Mix_PlayMusic() to play the music. 
       <br /> 
       <br /> The first argument of Mix_PlayMusic() is the music we're going to play. The second argument is how many times it will loop the music. Since it's set to -1, it will loop until it is manually stopped. 
       <br /> 
       <br /> If there's a problem in playing the music Mix_PlayMusic() will return -1. 
      </div> 
      <pre class="tutCode prettyprint linenums:171 lang-cpp">                    //If music is being played
                    else
                    {
                        //If the music is paused
                        if( Mix_PausedMusic() == 1 )
                        {
                            //Resume the music
                            Mix_ResumeMusic();
                        }
                        //If the music is playing
                        else
                        {
                            //Pause the music
                            Mix_PauseMusic();
                        }
                    }
                }
</pre> 
      <div class="tutText">
        Now if music was playing when the user pressed 9, we either pause or unpause the music. 
       <br /> 
       <br /> First we check if the music is playing using Mix_PausedMusic(). If it is, we unpause the music using Mix_ResumeMusic(). If the music is not paused, we pause it using Mix_PauseMusic() 
      </div> 
      <pre class="tutCode prettyprint linenums:188 lang-cpp">                //If 0 was pressed
                else if( event.key.keysym.sym == SDLK_0 )
                {
                    //Stop the music
                    Mix_HaltMusic();
                }
            }
</pre> 
      <div class="tutText">
        Lastly, We check if the user presses 0. 
       <br /> 
       <br /> If the user presses 0, the music is stopped using Mix_HaltMusic(). 
      </div> 
      <div class="tutFooter">
        Download the media and source code for this tutorial 
       <a class="tutLink" href="../../downloads/index.php@file=SDLTut_lesson11">here</a>. 
       <br /> 
       <br /> I highly recommend that you download the 
       <a class="tutLink" href="../../../jcatki.no-ip.org_3A8080/SDL_mixer/SDL_mixer_html.zip">SDL_mixer documentation</a>, and keep it around for reference. 
       <br /> 
       <br /> 
       <a class="leftNav" href="../lesson10/index.php">Previous Tutorial</a> 
       <a class="rightNav" href="../lesson12/index.php">Next Tutorial</a> 
       <br /> 
      </div>
     </div> 
    </div> 
   </div> 
   <!-- End of main contents--> 
   <!-- Footer
      ================================================== --> 
   <footer class="footer"> 
    <p class="pull-right"> <a href="#">返回页首</a> </p> 
    <p> 翻译及网站编辑：<a href="../../about.html">tjumyk</a>.<br /> 由来自Twitter的<a href="http://getbootstrap.com" target="_blank">Bootstrap </a>强力驱动. </p> 
    <p> 所有内容采用<a target="_blank" href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>许可. </p> 
    <p> 引用图标来自<a target="_blank" href="http://glyphicons.com">Glyphicons Free</a>, 采用 <a target="_blank" href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>许可. </p> 
   </footer> 
  </div> 
  <!-- /container --> 
  <!-- Le javascript
    ================================================== --> 
  <!-- Placed at the end of the document so the pages load faster --> 
  <script src="../../assets/js/jquery.js"></script> 
  <script src="../../assets/js/google-code-prettify/prettify.js"></script> 
  <script src="../../assets/js/bootstrap-transition.js"></script> 
  <script src="../../assets/js/bootstrap-alert.js"></script> 
  <script src="../../assets/js/bootstrap-modal.js"></script> 
  <script src="../../assets/js/bootstrap-dropdown.js"></script> 
  <script src="../../assets/js/bootstrap-scrollspy.js"></script> 
  <script src="../../assets/js/bootstrap-tab.js"></script> 
  <script src="../../assets/js/bootstrap-tooltip.js"></script> 
  <script src="../../assets/js/bootstrap-popover.js"></script> 
  <script src="../../assets/js/bootstrap-button.js"></script> 
  <script src="../../assets/js/bootstrap-collapse.js"></script> 
  <script src="../../assets/js/bootstrap-carousel.js"></script> 
  <script src="../../assets/js/bootstrap-typeahead.js"></script> 
  <script src="../../assets/js/application.js"></script>  
 </body>
</html>